<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DataFusion ClickBench Performance Analysis</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            line-height: 1.6;
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f8f9fa;
        }
        .container {
            background-color: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #2c3e50;
            border-bottom: 3px solid #3498db;
            padding-bottom: 10px;
            text-align: center;
        }
        h2 {
            color: #34495e;
            margin-top: 30px;
            border-left: 4px solid #3498db;
            padding-left: 15px;
        }
        h3 {
            color: #555;
            margin-top: 25px;
        }
        .chart-section {
            margin: 40px 0;
            padding: 20px;
            background-color: #f8f9fa;
            border-radius: 8px;
            border: 1px solid #dee2e6;
        }
        .chart-container {
            margin: 20px 0;
            border: 1px solid #ddd;
            border-radius: 8px;
            overflow: hidden;
        }
        .filter-section {
            margin: 0;
            padding: 20px;
            background-color: #e3f2fd;
            border-radius: 8px;
            border-left: 4px solid #2196f3;
        }
        .filter-section h3 {
            margin-top: 0;
            color: #1976d2;
        }
        .filter-dropdown {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
            background-color: white;
            cursor: pointer;
        }
        .instructions {
            background-color: #e3f2fd;
            padding: 20px;
            border-radius: 8px;
            border-left: 4px solid #2196f3;
            margin: 20px 0;
        }
        .instructions h3 {
            margin-top: 0;
            color: #1976d2;
        }
        .instructions ul {
            margin: 10px 0;
        }
        .instructions li {
            margin: 5px 0;
        }
        .info-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 20px 0;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            background-color: white;
        }
        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #dee2e6;
        }
        th {
            background-color: #f8f9fa;
            font-weight: 600;
            color: #495057;
        }
        tr:hover {
            background-color: #f8f9fa;
        }
        .footer {
            margin-top: 40px;
            padding-top: 20px;
            border-top: 1px solid #dee2e6;
            text-align: center;
            color: #6c757d;
            font-style: italic;
        }
        .two-column {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 20px 0;
        }
        @media (max-width: 768px) {
            .two-column {
                grid-template-columns: 1fr;
            }
            .info-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üöÄ DataFusion ClickBench Performance Analysis</h1>

        <div class="info-grid">
            <div class="instructions">
                <h3>üí° How to Use the Interactive Charts</h3>
                <ol>
                    <li><strong>Filter by queries:</strong> Click on query names in legends to show/hide them, double click to focus</li>
                    <li><strong>Compare performance:</strong> Hover to see details</li>
                    <li><strong>Reset views:</strong> Double-click on charts to reset zoom level</li>
                </ol>
            </div>

            <div class="filter-section">
                <h3>üìÖ Time Period Filter</h3>
                <p>Select a time period to focus your analysis:</p>
                <select id="timeFilter" class="filter-dropdown" onchange="updateCharts()">
                    <option value="releases_vs_main" selected>Releases vs Main</option>
                    <option value="last_week">Last 1 Week</option>
                    <option value="last_3_months">Last 3 Months</option>
                    <option value="last_6_months">Last 6 Months</option>
                    <option value="all">All Data</option>
                </select>
                <div style="margin-top: 15px;">
                    <label style="display: flex; align-items: center; gap: 8px; font-size: 14px;">
                        <input type="checkbox" id="showReleaseLines" checked onchange="updateCharts()" style="margin: 0;">
                        Show releases
                    </label>
                </div>
                <div style="margin-top: 10px;">
                    <label style="display: flex; align-items: center; gap: 8px; font-size: 14px;">
                        <input type="checkbox" id="showEventLines" checked onchange="updateCharts()" style="margin: 0;">
                        Show events
                    </label>
                </div>
                <div id="filterDescription" style="margin-top: 10px; font-style: italic; color: #666;">
                    Releases and most recent git revision
                </div>
            </div>
        </div>

        <h2>üìä Interactive Performance Charts</h2>

        <div class="chart-section">
            <h3>Overall Performance</h3>
            <p>
                Interactive chart: average, and median <strong>normalized query execution times</strong> for all queries for each git revision. 
                Query times are normalized using the <a href="https://github.com/ClickHouse/ClickBench?tab=readme-ov-file#results-usage-and-scoreboards" target="_blank">ClickBench definition</a>: 
                for each query, the fastest time across all revisions is used as a baseline, and normalized times are calculated as 
                <code>(10ms + query_time) / (10ms + baseline_time)</code>. 
                This gives values <code> ‚â• 1.0</code>, where <code>1.0</code> represents the best performance for that query.</p>
            <div class="chart-container">
                <div id="performance_chart"></div>
            </div>
        </div>

        <div class="chart-section">
            <h3>Individual Query Performance</h3>
            <p>Interactive chart: Individual query performance over time - click legend items to show/hide specific queries.</p>
            <div class="chart-container">
                <div id="per_query_chart"></div>
            </div>
        </div>


        <h2>üóÇÔ∏è Data </h2>        
        <p>
            <li>
                The analysis covers <strong>5</strong> different git revisions
            </li>
            <li>
                <strong>Data from:</strong> 2025-02-03T16:26:35-05:00 to 2025-07-22T08:14:50-04:00
                (<a href="https://github.com/alamb/datafusion-benchmarking/tree/main/results">download</a>)
            </li>
        </p>

        <div class="footer">
            <p>
                <strong>Generated on:</strong> 2025-07-25 11:47:14
                with code from <a href="https://github.com/alamb/datafusion-benchmarking">alamb/datafusion-benchmarking</a> 
            </p>
        </div>
    </div>

    <script>
        // Store all chart data for filtering
        var chartData = {"performance": {"config": {"responsive": true}, "data": [{"customdata": ["45.0.0", "46.0.0", "47.0.0", "48.0.1", "branch-49"], "hovertemplate": "<b>Average Normalized Time</b><br>Date: %{x}<br>Git SHA: %{customdata}<br>Normalized Ratio: %{y:.3f}<br><extra></extra>", "line": {"color": "green", "width": 2}, "marker": {"size": 4, "symbol": "triangle-up"}, "mode": "lines+markers", "name": "Average Normalized Time", "x": ["2025-02-03T21:26:35.000000Z", "2025-03-04T14:00:39.000000Z", "2025-04-16T19:35:01.000000Z", "2025-07-04T10:05:02.000000Z", "2025-07-22T12:14:50.000000Z"], "y": [1.5190111857641075, 1.4088800937849022, 1.1894217871869441, 1.1730359712777243, 1.1208816524276906]}, {"customdata": ["45.0.0", "46.0.0", "47.0.0", "48.0.1", "branch-49"], "hovertemplate": "<b>Median Normalized Time</b><br>Date: %{x}<br>Git SHA: %{customdata}<br>Normalized Ratio: %{y:.3f}<br><extra></extra>", "line": {"color": "orange", "width": 2}, "marker": {"size": 4, "symbol": "diamond"}, "mode": "lines+markers", "name": "Median Normalized Time", "x": ["2025-02-03T21:26:35.000000Z", "2025-03-04T14:00:39.000000Z", "2025-04-16T19:35:01.000000Z", "2025-07-04T10:05:02.000000Z", "2025-07-22T12:14:50.000000Z"], "y": [1.3492622003047683, 1.2792682926829266, 1.0979899497487438, 1.0868496517820565, 1.0287958115183247]}], "layout": {"annotations": [{"CUSTOM_ANNOTATION": "release", "bgcolor": "rgba(255,255,255,0.7)", "bordercolor": "red", "font": {"color": "red", "size": 12}, "showarrow": false, "text": "49.0.0", "x": "2025-07-22T12:14:50.000000Z", "xanchor": "left", "y": 1.01, "yanchor": "bottom", "yref": "paper"}, {"CUSTOM_ANNOTATION": "release", "bgcolor": "rgba(255,255,255,0.7)", "bordercolor": "red", "font": {"color": "red", "size": 12}, "showarrow": false, "text": "48.0.1", "x": "2025-07-04T10:05:02.000000Z", "xanchor": "left", "y": 1.01, "yanchor": "bottom", "yref": "paper"}, {"CUSTOM_ANNOTATION": "release", "bgcolor": "rgba(255,255,255,0.7)", "bordercolor": "red", "font": {"color": "red", "size": 12}, "showarrow": false, "text": "47.0.0", "x": "2025-04-16T19:35:01.000000Z", "xanchor": "left", "y": 1.01, "yanchor": "bottom", "yref": "paper"}, {"CUSTOM_ANNOTATION": "release", "bgcolor": "rgba(255,255,255,0.7)", "bordercolor": "red", "font": {"color": "red", "size": 12}, "showarrow": false, "text": "46.0.0", "x": "2025-03-04T14:00:39.000000Z", "xanchor": "left", "y": 1.01, "yanchor": "bottom", "yref": "paper"}, {"CUSTOM_ANNOTATION": "release", "bgcolor": "rgba(255,255,255,0.7)", "bordercolor": "red", "font": {"color": "red", "size": 12}, "showarrow": false, "text": "45.0.0", "x": "2025-02-03T21:26:35.000000Z", "xanchor": "left", "y": 1.01, "yanchor": "bottom", "yref": "paper"}], "height": 500, "hovermode": "x unified", "margin": {"b": 50, "l": 50, "r": 50, "t": 80}, "shapes": [{"CUSTOM_ANNOTATION": "release", "line": {"color": "red", "dash": "dash", "width": 2}, "type": "line", "x0": "2025-07-22T12:14:50.000000Z", "x1": "2025-07-22T12:14:50.000000Z", "y0": 0, "y1": 1, "yref": "paper"}, {"CUSTOM_ANNOTATION": "release", "line": {"color": "red", "dash": "dash", "width": 2}, "type": "line", "x0": "2025-07-04T10:05:02.000000Z", "x1": "2025-07-04T10:05:02.000000Z", "y0": 0, "y1": 1, "yref": "paper"}, {"CUSTOM_ANNOTATION": "release", "line": {"color": "red", "dash": "dash", "width": 2}, "type": "line", "x0": "2025-04-16T19:35:01.000000Z", "x1": "2025-04-16T19:35:01.000000Z", "y0": 0, "y1": 1, "yref": "paper"}, {"CUSTOM_ANNOTATION": "release", "line": {"color": "red", "dash": "dash", "width": 2}, "type": "line", "x0": "2025-03-04T14:00:39.000000Z", "x1": "2025-03-04T14:00:39.000000Z", "y0": 0, "y1": 1, "yref": "paper"}, {"CUSTOM_ANNOTATION": "release", "line": {"color": "red", "dash": "dash", "width": 2}, "type": "line", "x0": "2025-02-03T21:26:35.000000Z", "x1": "2025-02-03T21:26:35.000000Z", "y0": 0, "y1": 1, "yref": "paper"}], "template": "plotly_white", "title": "Normalized Performance Over Time (ClickBench Definition)", "xaxis": {"title": "Git Revision Timestamp"}, "yaxis": {"title": "Normalized Query Time Ratio", "type": "linear"}}}, "queries": {"config": {"displayModeBar": true, "responsive": true}, "data": [{"customdata": ["45.0.0", "46.0.0", "47.0.0", "48.0.1", "branch-49"], "hovertemplate": "<b>q6</b><br>Date: %{x}<br>Git SHA: %{customdata}<br>Normalized Ratio: %{y:.4f}s<br><extra></extra>", "line": {"width": 2}, "marker": {"size": 4}, "mode": "lines+markers", "name": "q6", "visible": true, "x": ["2025-02-03T21:26:35.000000Z", "2025-03-04T14:00:39.000000Z", "2025-04-16T19:35:01.000000Z", "2025-07-04T10:05:02.000000Z", "2025-07-22T12:14:50.000000Z"], "y": [3.5, 3.5833333333333335, 3.083333333333333, 1.0833333333333335, 1.0833333333333335]}, {"customdata": ["45.0.0", "46.0.0", "47.0.0", "48.0.1", "branch-49"], "hovertemplate": "<b>q0</b><br>Date: %{x}<br>Git SHA: %{customdata}<br>Normalized Ratio: %{y:.4f}s<br><extra></extra>", "line": {"width": 2}, "marker": {"size": 4}, "mode": "lines+markers", "name": "q0", "visible": true, "x": ["2025-02-03T21:26:35.000000Z", "2025-03-04T14:00:39.000000Z", "2025-04-16T19:35:01.000000Z", "2025-07-04T10:05:02.000000Z", "2025-07-22T12:14:50.000000Z"], "y": [2.5, 2.4166666666666665, 2.25, 1.0833333333333335, 1.0833333333333335]}, {"customdata": ["45.0.0", "46.0.0", "47.0.0", "48.0.1", "branch-49"], "hovertemplate": "<b>q42</b><br>Date: %{x}<br>Git SHA: %{customdata}<br>Normalized Ratio: %{y:.4f}s<br><extra></extra>", "line": {"width": 2}, "marker": {"size": 4}, "mode": "lines+markers", "name": "q42", "visible": true, "x": ["2025-02-03T21:26:35.000000Z", "2025-03-04T14:00:39.000000Z", "2025-04-16T19:35:01.000000Z", "2025-07-04T10:05:02.000000Z", "2025-07-22T12:14:50.000000Z"], "y": [1.9761904761904758, 1.9047619047619047, 1.1904761904761905, 1.1666666666666667, 1.0714285714285714]}, {"customdata": ["45.0.0", "46.0.0", "47.0.0", "48.0.1", "branch-49"], "hovertemplate": "<b>q40</b><br>Date: %{x}<br>Git SHA: %{customdata}<br>Normalized Ratio: %{y:.4f}s<br><extra></extra>", "line": {"width": 2}, "marker": {"size": 4}, "mode": "lines+markers", "name": "q40", "visible": true, "x": ["2025-02-03T21:26:35.000000Z", "2025-03-04T14:00:39.000000Z", "2025-04-16T19:35:01.000000Z", "2025-07-04T10:05:02.000000Z", "2025-07-22T12:14:50.000000Z"], "y": [1.8461538461538458, 1.8461538461538458, 1.2692307692307692, 1.1153846153846154, 1.0192307692307692]}, {"customdata": ["45.0.0", "46.0.0", "47.0.0", "48.0.1", "branch-49"], "hovertemplate": "<b>q4</b><br>Date: %{x}<br>Git SHA: %{customdata}<br>Normalized Ratio: %{y:.4f}s<br><extra></extra>", "line": {"width": 2}, "marker": {"size": 4}, "mode": "lines+markers", "name": "q4", "visible": true, "x": ["2025-02-03T21:26:35.000000Z", "2025-03-04T14:00:39.000000Z", "2025-04-16T19:35:01.000000Z", "2025-07-04T10:05:02.000000Z", "2025-07-22T12:14:50.000000Z"], "y": [1.6907563025210084, 1.6201680672268908, 1.4571428571428573, 1.0436974789915967, 1.053781512605042]}, {"customdata": ["45.0.0", "46.0.0", "47.0.0", "48.0.1", "branch-49"], "hovertemplate": "<b>q15</b><br>Date: %{x}<br>Git SHA: %{customdata}<br>Normalized Ratio: %{y:.4f}s<br><extra></extra>", "line": {"width": 2}, "marker": {"size": 4}, "mode": "lines+markers", "name": "q15", "visible": true, "x": ["2025-02-03T21:26:35.000000Z", "2025-03-04T14:00:39.000000Z", "2025-04-16T19:35:01.000000Z", "2025-07-04T10:05:02.000000Z", "2025-07-22T12:14:50.000000Z"], "y": [1.6014084507042254, 1.5985915492957747, 1.3323943661971833, 1.0845070422535212, 1.0267605633802817]}, {"customdata": ["45.0.0", "46.0.0", "47.0.0", "48.0.1", "branch-49"], "hovertemplate": "<b>q41</b><br>Date: %{x}<br>Git SHA: %{customdata}<br>Normalized Ratio: %{y:.4f}s<br><extra></extra>", "line": {"width": 2}, "marker": {"size": 4}, "mode": "lines+markers", "name": "q41", "visible": true, "x": ["2025-02-03T21:26:35.000000Z", "2025-03-04T14:00:39.000000Z", "2025-04-16T19:35:01.000000Z", "2025-07-04T10:05:02.000000Z", "2025-07-22T12:14:50.000000Z"], "y": [1.7169811320754718, 1.7169811320754718, 1.0566037735849056, 1.0377358490566038, 1.1132075471698115]}, {"customdata": ["45.0.0", "46.0.0", "47.0.0", "48.0.1", "branch-49"], "hovertemplate": "<b>q37</b><br>Date: %{x}<br>Git SHA: %{customdata}<br>Normalized Ratio: %{y:.4f}s<br><extra></extra>", "line": {"width": 2}, "marker": {"size": 4}, "mode": "lines+markers", "name": "q37", "visible": true, "x": ["2025-02-03T21:26:35.000000Z", "2025-03-04T14:00:39.000000Z", "2025-04-16T19:35:01.000000Z", "2025-07-04T10:05:02.000000Z", "2025-07-22T12:14:50.000000Z"], "y": [1.6984126984126984, 1.6666666666666665, 1.0952380952380951, 1.0952380952380951, 1.0158730158730158]}, {"customdata": ["45.0.0", "46.0.0", "47.0.0", "48.0.1", "branch-49"], "hovertemplate": "<b>q25</b><br>Date: %{x}<br>Git SHA: %{customdata}<br>Normalized Ratio: %{y:.4f}s<br><extra></extra>", "line": {"width": 2}, "marker": {"size": 4}, "mode": "lines+markers", "name": "q25", "visible": true, "x": ["2025-02-03T21:26:35.000000Z", "2025-03-04T14:00:39.000000Z", "2025-04-16T19:35:01.000000Z", "2025-07-04T10:05:02.000000Z", "2025-07-22T12:14:50.000000Z"], "y": [1.5125, 1.396875, 1.2906250000000001, 1.3343749999999999, 1.015625]}, {"customdata": ["45.0.0", "46.0.0", "47.0.0", "48.0.1", "branch-49"], "hovertemplate": "<b>q18</b><br>Date: %{x}<br>Git SHA: %{customdata}<br>Normalized Ratio: %{y:.4f}s<br><extra></extra>", "line": {"width": 2}, "marker": {"size": 4}, "mode": "lines+markers", "name": "q18", "visible": true, "x": ["2025-02-03T21:26:35.000000Z", "2025-03-04T14:00:39.000000Z", "2025-04-16T19:35:01.000000Z", "2025-07-04T10:05:02.000000Z", "2025-07-22T12:14:50.000000Z"], "y": [1.5709090909090906, 1.5021818181818183, 1.1436363636363636, 1.1465454545454543, 1.0098181818181817]}, {"customdata": ["45.0.0", "46.0.0", "47.0.0", "48.0.1", "branch-49"], "hovertemplate": "<b>q26</b><br>Date: %{x}<br>Git SHA: %{customdata}<br>Normalized Ratio: %{y:.4f}s<br><extra></extra>", "line": {"width": 2}, "marker": {"size": 4}, "mode": "lines+markers", "name": "q26", "visible": true, "x": ["2025-02-03T21:26:35.000000Z", "2025-03-04T14:00:39.000000Z", "2025-04-16T19:35:01.000000Z", "2025-07-04T10:05:02.000000Z", "2025-07-22T12:14:50.000000Z"], "y": [1.4349775784753362, 1.3654708520179373, 1.2533632286995517, 1.2466367713004485, 1.0560538116591929]}, {"customdata": ["45.0.0", "46.0.0", "47.0.0", "48.0.1", "branch-49"], "hovertemplate": "<b>q32</b><br>Date: %{x}<br>Git SHA: %{customdata}<br>Normalized Ratio: %{y:.4f}s<br><extra></extra>", "line": {"width": 2}, "marker": {"size": 4}, "mode": "lines+markers", "name": "q32", "visible": true, "x": ["2025-02-03T21:26:35.000000Z", "2025-03-04T14:00:39.000000Z", "2025-04-16T19:35:01.000000Z", "2025-07-04T10:05:02.000000Z", "2025-07-22T12:14:50.000000Z"], "y": [1.4984227129337542, 1.55205047318612, 1.1238170347003156, 1.1305205047318614, 1.0307570977917981]}, {"customdata": ["45.0.0", "46.0.0", "47.0.0", "48.0.1", "branch-49"], "hovertemplate": "<b>q16</b><br>Date: %{x}<br>Git SHA: %{customdata}<br>Normalized Ratio: %{y:.4f}s<br><extra></extra>", "line": {"width": 2}, "marker": {"size": 4}, "mode": "lines+markers", "name": "q16", "visible": true, "x": ["2025-02-03T21:26:35.000000Z", "2025-03-04T14:00:39.000000Z", "2025-04-16T19:35:01.000000Z", "2025-07-04T10:05:02.000000Z", "2025-07-22T12:14:50.000000Z"], "y": [1.4358638743455496, 1.3717277486910993, 1.1027486910994764, 1.0916230366492146, 1.0379581151832462]}, {"customdata": ["45.0.0", "46.0.0", "47.0.0", "48.0.1", "branch-49"], "hovertemplate": "<b>q38</b><br>Date: %{x}<br>Git SHA: %{customdata}<br>Normalized Ratio: %{y:.4f}s<br><extra></extra>", "line": {"width": 2}, "marker": {"size": 4}, "mode": "lines+markers", "name": "q38", "visible": true, "x": ["2025-02-03T21:26:35.000000Z", "2025-03-04T14:00:39.000000Z", "2025-04-16T19:35:01.000000Z", "2025-07-04T10:05:02.000000Z", "2025-07-22T12:14:50.000000Z"], "y": [1.4263565891472867, 1.372093023255814, 1.054263565891473, 1.116279069767442, 1.0155038759689923]}, {"customdata": ["45.0.0", "46.0.0", "47.0.0", "48.0.1", "branch-49"], "hovertemplate": "<b>q12</b><br>Date: %{x}<br>Git SHA: %{customdata}<br>Normalized Ratio: %{y:.4f}s<br><extra></extra>", "line": {"width": 2}, "marker": {"size": 4}, "mode": "lines+markers", "name": "q12", "visible": true, "x": ["2025-02-03T21:26:35.000000Z", "2025-03-04T14:00:39.000000Z", "2025-04-16T19:35:01.000000Z", "2025-07-04T10:05:02.000000Z", "2025-07-22T12:14:50.000000Z"], "y": [1.379224030037547, 1.2803504380475592, 1.1389236545682102, 1.1364205256570714, 1.0425531914893615]}, {"customdata": ["45.0.0", "46.0.0", "47.0.0", "48.0.1", "branch-49"], "hovertemplate": "<b>q31</b><br>Date: %{x}<br>Git SHA: %{customdata}<br>Normalized Ratio: %{y:.4f}s<br><extra></extra>", "line": {"width": 2}, "marker": {"size": 4}, "mode": "lines+markers", "name": "q31", "visible": true, "x": ["2025-02-03T21:26:35.000000Z", "2025-03-04T14:00:39.000000Z", "2025-04-16T19:35:01.000000Z", "2025-07-04T10:05:02.000000Z", "2025-07-22T12:14:50.000000Z"], "y": [1.352941176470588, 1.2954248366013073, 1.099346405228758, 1.138562091503268, 1.0405228758169935]}, {"customdata": ["45.0.0", "46.0.0", "47.0.0", "48.0.1", "branch-49"], "hovertemplate": "<b>q13</b><br>Date: %{x}<br>Git SHA: %{customdata}<br>Normalized Ratio: %{y:.4f}s<br><extra></extra>", "line": {"width": 2}, "marker": {"size": 4}, "mode": "lines+markers", "name": "q13", "visible": true, "x": ["2025-02-03T21:26:35.000000Z", "2025-03-04T14:00:39.000000Z", "2025-04-16T19:35:01.000000Z", "2025-07-04T10:05:02.000000Z", "2025-07-22T12:14:50.000000Z"], "y": [1.3598673300165838, 1.262023217247098, 1.1293532338308458, 1.099502487562189, 1.0688225538971807]}, {"customdata": ["45.0.0", "46.0.0", "47.0.0", "48.0.1", "branch-49"], "hovertemplate": "<b>q8</b><br>Date: %{x}<br>Git SHA: %{customdata}<br>Normalized Ratio: %{y:.4f}s<br><extra></extra>", "line": {"width": 2}, "marker": {"size": 4}, "mode": "lines+markers", "name": "q8", "visible": true, "x": ["2025-02-03T21:26:35.000000Z", "2025-03-04T14:00:39.000000Z", "2025-04-16T19:35:01.000000Z", "2025-07-04T10:05:02.000000Z", "2025-07-22T12:14:50.000000Z"], "y": [1.374390243902439, 1.3036585365853657, 1.0756097560975608, 1.119512195121951, 1.0268292682926827]}, {"customdata": ["45.0.0", "46.0.0", "47.0.0", "48.0.1", "branch-49"], "hovertemplate": "<b>q34</b><br>Date: %{x}<br>Git SHA: %{customdata}<br>Normalized Ratio: %{y:.4f}s<br><extra></extra>", "line": {"width": 2}, "marker": {"size": 4}, "mode": "lines+markers", "name": "q34", "visible": true, "x": ["2025-02-03T21:26:35.000000Z", "2025-03-04T14:00:39.000000Z", "2025-04-16T19:35:01.000000Z", "2025-07-04T10:05:02.000000Z", "2025-07-22T12:14:50.000000Z"], "y": [1.3416230366492148, 1.3340968586387436, 1.0919502617801047, 1.0837696335078535, 1.018979057591623]}, {"customdata": ["45.0.0", "46.0.0", "47.0.0", "48.0.1", "branch-49"], "hovertemplate": "<b>q33</b><br>Date: %{x}<br>Git SHA: %{customdata}<br>Normalized Ratio: %{y:.4f}s<br><extra></extra>", "line": {"width": 2}, "marker": {"size": 4}, "mode": "lines+markers", "name": "q33", "visible": true, "x": ["2025-02-03T21:26:35.000000Z", "2025-03-04T14:00:39.000000Z", "2025-04-16T19:35:01.000000Z", "2025-07-04T10:05:02.000000Z", "2025-07-22T12:14:50.000000Z"], "y": [1.3431017451432334, 1.3299308528152782, 1.0971353309186698, 1.0842937108989132, 1.0144879815607508]}, {"customdata": ["45.0.0", "46.0.0", "47.0.0", "48.0.1", "branch-49"], "hovertemplate": "<b>q14</b><br>Date: %{x}<br>Git SHA: %{customdata}<br>Normalized Ratio: %{y:.4f}s<br><extra></extra>", "line": {"width": 2}, "marker": {"size": 4}, "mode": "lines+markers", "name": "q14", "visible": true, "x": ["2025-02-03T21:26:35.000000Z", "2025-03-04T14:00:39.000000Z", "2025-04-16T19:35:01.000000Z", "2025-07-04T10:05:02.000000Z", "2025-07-22T12:14:50.000000Z"], "y": [1.3506666666666665, 1.276, 1.1079999999999999, 1.1119999999999999, 1.0146666666666666]}, {"customdata": ["45.0.0", "46.0.0", "47.0.0", "48.0.1", "branch-49"], "hovertemplate": "<b>q22</b><br>Date: %{x}<br>Git SHA: %{customdata}<br>Normalized Ratio: %{y:.4f}s<br><extra></extra>", "line": {"width": 2}, "marker": {"size": 4}, "mode": "lines+markers", "name": "q22", "visible": true, "x": ["2025-02-03T21:26:35.000000Z", "2025-03-04T14:00:39.000000Z", "2025-04-16T19:35:01.000000Z", "2025-07-04T10:05:02.000000Z", "2025-07-22T12:14:50.000000Z"], "y": [1.3453169347209082, 1.2459791863765375, 1.1556291390728475, 1.0789971617786187, 1.0236518448438978]}, {"customdata": ["45.0.0", "46.0.0", "47.0.0", "48.0.1", "branch-49"], "hovertemplate": "<b>q36</b><br>Date: %{x}<br>Git SHA: %{customdata}<br>Normalized Ratio: %{y:.4f}s<br><extra></extra>", "line": {"width": 2}, "marker": {"size": 4}, "mode": "lines+markers", "name": "q36", "visible": true, "x": ["2025-02-03T21:26:35.000000Z", "2025-03-04T14:00:39.000000Z", "2025-04-16T19:35:01.000000Z", "2025-07-04T10:05:02.000000Z", "2025-07-22T12:14:50.000000Z"], "y": [1.362962962962963, 1.288888888888889, 1.0592592592592593, 1.0666666666666667, 1.037037037037037]}, {"customdata": ["45.0.0", "46.0.0", "47.0.0", "48.0.1", "branch-49"], "hovertemplate": "<b>q11</b><br>Date: %{x}<br>Git SHA: %{customdata}<br>Normalized Ratio: %{y:.4f}s<br><extra></extra>", "line": {"width": 2}, "marker": {"size": 4}, "mode": "lines+markers", "name": "q11", "visible": true, "x": ["2025-02-03T21:26:35.000000Z", "2025-03-04T14:00:39.000000Z", "2025-04-16T19:35:01.000000Z", "2025-07-04T10:05:02.000000Z", "2025-07-22T12:14:50.000000Z"], "y": [1.4055944055944056, 1.2272727272727273, 1.0699300699300698, 1.0734265734265733, 1.013986013986014]}, {"customdata": ["45.0.0", "46.0.0", "47.0.0", "48.0.1", "branch-49"], "hovertemplate": "<b>q2</b><br>Date: %{x}<br>Git SHA: %{customdata}<br>Normalized Ratio: %{y:.4f}s<br><extra></extra>", "line": {"width": 2}, "marker": {"size": 4}, "mode": "lines+markers", "name": "q2", "visible": true, "x": ["2025-02-03T21:26:35.000000Z", "2025-03-04T14:00:39.000000Z", "2025-04-16T19:35:01.000000Z", "2025-07-04T10:05:02.000000Z", "2025-07-22T12:14:50.000000Z"], "y": [1.2888888888888888, 1.2666666666666666, 1.0999999999999999, 1.0555555555555556, 1.0666666666666667]}, {"customdata": ["45.0.0", "46.0.0", "47.0.0", "48.0.1", "branch-49"], "hovertemplate": "<b>q24</b><br>Date: %{x}<br>Git SHA: %{customdata}<br>Normalized Ratio: %{y:.4f}s<br><extra></extra>", "line": {"width": 2}, "marker": {"size": 4}, "mode": "lines+markers", "name": "q24", "visible": true, "x": ["2025-02-03T21:26:35.000000Z", "2025-03-04T14:00:39.000000Z", "2025-04-16T19:35:01.000000Z", "2025-07-04T10:05:02.000000Z", "2025-07-22T12:14:50.000000Z"], "y": [1.2930648769574944, 1.2080536912751678, 1.1319910514541387, 1.0760626398210291, 1.0156599552572707]}, {"customdata": ["45.0.0", "46.0.0", "47.0.0", "48.0.1", "branch-49"], "hovertemplate": "<b>q9</b><br>Date: %{x}<br>Git SHA: %{customdata}<br>Normalized Ratio: %{y:.4f}s<br><extra></extra>", "line": {"width": 2}, "marker": {"size": 4}, "mode": "lines+markers", "name": "q9", "visible": true, "x": ["2025-02-03T21:26:35.000000Z", "2025-03-04T14:00:39.000000Z", "2025-04-16T19:35:01.000000Z", "2025-07-04T10:05:02.000000Z", "2025-07-22T12:14:50.000000Z"], "y": [1.279569892473118, 1.210573476702509, 1.1066308243727598, 1.1129032258064515, 1.014336917562724]}, {"customdata": ["45.0.0", "46.0.0", "47.0.0", "48.0.1", "branch-49"], "hovertemplate": "<b>q39</b><br>Date: %{x}<br>Git SHA: %{customdata}<br>Normalized Ratio: %{y:.4f}s<br><extra></extra>", "line": {"width": 2}, "marker": {"size": 4}, "mode": "lines+markers", "name": "q39", "visible": true, "x": ["2025-02-03T21:26:35.000000Z", "2025-03-04T14:00:39.000000Z", "2025-04-16T19:35:01.000000Z", "2025-07-04T10:05:02.000000Z", "2025-07-22T12:14:50.000000Z"], "y": [1.2594339622641508, 1.2735849056603774, 1.080188679245283, 1.0660377358490565, 1.0188679245283017]}, {"customdata": ["45.0.0", "46.0.0", "47.0.0", "48.0.1", "branch-49"], "hovertemplate": "<b>q1</b><br>Date: %{x}<br>Git SHA: %{customdata}<br>Normalized Ratio: %{y:.4f}s<br><extra></extra>", "line": {"width": 2}, "marker": {"size": 4}, "mode": "lines+markers", "name": "q1", "visible": true, "x": ["2025-02-03T21:26:35.000000Z", "2025-03-04T14:00:39.000000Z", "2025-04-16T19:35:01.000000Z", "2025-07-04T10:05:02.000000Z", "2025-07-22T12:14:50.000000Z"], "y": [1.2790697674418603, 1.2558139534883719, 1.069767441860465, 1.0465116279069768, 1.0465116279069768]}, {"customdata": ["45.0.0", "46.0.0", "47.0.0", "48.0.1", "branch-49"], "hovertemplate": "<b>q7</b><br>Date: %{x}<br>Git SHA: %{customdata}<br>Normalized Ratio: %{y:.4f}s<br><extra></extra>", "line": {"width": 2}, "marker": {"size": 4}, "mode": "lines+markers", "name": "q7", "visible": true, "x": ["2025-02-03T21:26:35.000000Z", "2025-03-04T14:00:39.000000Z", "2025-04-16T19:35:01.000000Z", "2025-07-04T10:05:02.000000Z", "2025-07-22T12:14:50.000000Z"], "y": [1.2608695652173914, 1.2173913043478262, 1.108695652173913, 1.0869565217391306, 1.0217391304347827]}, {"customdata": ["45.0.0", "46.0.0", "47.0.0", "48.0.1", "branch-49"], "hovertemplate": "<b>q30</b><br>Date: %{x}<br>Git SHA: %{customdata}<br>Normalized Ratio: %{y:.4f}s<br><extra></extra>", "line": {"width": 2}, "marker": {"size": 4}, "mode": "lines+markers", "name": "q30", "visible": true, "x": ["2025-02-03T21:26:35.000000Z", "2025-03-04T14:00:39.000000Z", "2025-04-16T19:35:01.000000Z", "2025-07-04T10:05:02.000000Z", "2025-07-22T12:14:50.000000Z"], "y": [1.2895805142083896, 1.2557510148849798, 1.0527740189445196, 1.0568335588633289, 1.0284167794316645]}, {"customdata": ["45.0.0", "46.0.0", "47.0.0", "48.0.1", "branch-49"], "hovertemplate": "<b>q23</b><br>Date: %{x}<br>Git SHA: %{customdata}<br>Normalized Ratio: %{y:.4f}s<br><extra></extra>", "line": {"width": 2}, "marker": {"size": 4}, "mode": "lines+markers", "name": "q23", "visible": true, "x": ["2025-02-03T21:26:35.000000Z", "2025-03-04T14:00:39.000000Z", "2025-04-16T19:35:01.000000Z", "2025-07-04T10:05:02.000000Z", "2025-07-22T12:14:50.000000Z"], "y": [1.203468523829032, 1.2224498156493242, 1.1396968455551004, 1.0979106923392052, 1.0038235695753108]}, {"customdata": ["45.0.0", "46.0.0", "47.0.0", "48.0.1", "branch-49"], "hovertemplate": "<b>q17</b><br>Date: %{x}<br>Git SHA: %{customdata}<br>Normalized Ratio: %{y:.4f}s<br><extra></extra>", "line": {"width": 2}, "marker": {"size": 4}, "mode": "lines+markers", "name": "q17", "visible": true, "x": ["2025-02-03T21:26:35.000000Z", "2025-03-04T14:00:39.000000Z", "2025-04-16T19:35:01.000000Z", "2025-07-04T10:05:02.000000Z", "2025-07-22T12:14:50.000000Z"], "y": [1.3284864507600793, 1.2736285525446134, 1.017184401850628, 1.0218109715796433, 1.024454725710509]}, {"customdata": ["45.0.0", "46.0.0", "47.0.0", "48.0.1", "branch-49"], "hovertemplate": "<b>q10</b><br>Date: %{x}<br>Git SHA: %{customdata}<br>Normalized Ratio: %{y:.4f}s<br><extra></extra>", "line": {"width": 2}, "marker": {"size": 4}, "mode": "lines+markers", "name": "q10", "visible": true, "x": ["2025-02-03T21:26:35.000000Z", "2025-03-04T14:00:39.000000Z", "2025-04-16T19:35:01.000000Z", "2025-07-04T10:05:02.000000Z", "2025-07-22T12:14:50.000000Z"], "y": [1.3358490566037735, 1.1660377358490566, 1.0452830188679245, 1.0452830188679245, 1.0113207547169811]}, {"customdata": ["45.0.0", "46.0.0", "47.0.0", "48.0.1", "branch-49"], "hovertemplate": "<b>q35</b><br>Date: %{x}<br>Git SHA: %{customdata}<br>Normalized Ratio: %{y:.4f}s<br><extra></extra>", "line": {"width": 2}, "marker": {"size": 4}, "mode": "lines+markers", "name": "q35", "visible": true, "x": ["2025-02-03T21:26:35.000000Z", "2025-03-04T14:00:39.000000Z", "2025-04-16T19:35:01.000000Z", "2025-07-04T10:05:02.000000Z", "2025-07-22T12:14:50.000000Z"], "y": [1.200527704485488, 1.2040457343887423, 1.0448548812664906, 1.1187335092348285, 1.0299032541776605]}, {"customdata": ["45.0.0", "46.0.0", "47.0.0", "48.0.1", "branch-49"], "hovertemplate": "<b>q21</b><br>Date: %{x}<br>Git SHA: %{customdata}<br>Normalized Ratio: %{y:.4f}s<br><extra></extra>", "line": {"width": 2}, "marker": {"size": 4}, "mode": "lines+markers", "name": "q21", "visible": true, "x": ["2025-02-03T21:26:35.000000Z", "2025-03-04T14:00:39.000000Z", "2025-04-16T19:35:01.000000Z", "2025-07-04T10:05:02.000000Z", "2025-07-22T12:14:50.000000Z"], "y": [1.2494279176201373, 1.1578947368421053, 1.0755148741418765, 1.0770404271548437, 1.0259344012204423]}, {"customdata": ["45.0.0", "46.0.0", "47.0.0", "48.0.1", "branch-49"], "hovertemplate": "<b>q5</b><br>Date: %{x}<br>Git SHA: %{customdata}<br>Normalized Ratio: %{y:.4f}s<br><extra></extra>", "line": {"width": 2}, "marker": {"size": 4}, "mode": "lines+markers", "name": "q5", "visible": true, "x": ["2025-02-03T21:26:35.000000Z", "2025-03-04T14:00:39.000000Z", "2025-04-16T19:35:01.000000Z", "2025-07-04T10:05:02.000000Z", "2025-07-22T12:14:50.000000Z"], "y": [1.2520808561236623, 1.1890606420927468, 1.028537455410226, 1.0570749108204518, 1.0321046373365041]}, {"customdata": ["45.0.0", "46.0.0", "47.0.0", "48.0.1", "branch-49"], "hovertemplate": "<b>q27</b><br>Date: %{x}<br>Git SHA: %{customdata}<br>Normalized Ratio: %{y:.4f}s<br><extra></extra>", "line": {"width": 2}, "marker": {"size": 4}, "mode": "lines+markers", "name": "q27", "visible": true, "x": ["2025-02-03T21:26:35.000000Z", "2025-03-04T14:00:39.000000Z", "2025-04-16T19:35:01.000000Z", "2025-07-04T10:05:02.000000Z", "2025-07-22T12:14:50.000000Z"], "y": [1.1846733668341707, 1.1802763819095476, 1.0973618090452262, 1.060929648241206, 1.0056532663316582]}, {"customdata": ["45.0.0", "46.0.0", "47.0.0", "48.0.1", "branch-49"], "hovertemplate": "<b>q19</b><br>Date: %{x}<br>Git SHA: %{customdata}<br>Normalized Ratio: %{y:.4f}s<br><extra></extra>", "line": {"width": 2}, "marker": {"size": 4}, "mode": "lines+markers", "name": "q19", "visible": true, "x": ["2025-02-03T21:26:35.000000Z", "2025-03-04T14:00:39.000000Z", "2025-04-16T19:35:01.000000Z", "2025-07-04T10:05:02.000000Z", "2025-07-22T12:14:50.000000Z"], "y": [1.1340206185567012, 1.0927835051546393, 1.0309278350515465, 1.0309278350515465, 1.0515463917525774]}, {"customdata": ["45.0.0", "46.0.0", "47.0.0", "48.0.1", "branch-49"], "hovertemplate": "<b>q3</b><br>Date: %{x}<br>Git SHA: %{customdata}<br>Normalized Ratio: %{y:.4f}s<br><extra></extra>", "line": {"width": 2}, "marker": {"size": 4}, "mode": "lines+markers", "name": "q3", "visible": true, "x": ["2025-02-03T21:26:35.000000Z", "2025-03-04T14:00:39.000000Z", "2025-04-16T19:35:01.000000Z", "2025-07-04T10:05:02.000000Z", "2025-07-22T12:14:50.000000Z"], "y": [1.1376146788990826, 1.091743119266055, 1.0091743119266054, 1.036697247706422, 1.055045871559633]}, {"customdata": ["45.0.0", "46.0.0", "47.0.0", "48.0.1", "branch-49"], "hovertemplate": "<b>q29</b><br>Date: %{x}<br>Git SHA: %{customdata}<br>Normalized Ratio: %{y:.4f}s<br><extra></extra>", "line": {"width": 2}, "marker": {"size": 4}, "mode": "lines+markers", "name": "q29", "visible": true, "x": ["2025-02-03T21:26:35.000000Z", "2025-03-04T14:00:39.000000Z", "2025-04-16T19:35:01.000000Z", "2025-07-04T10:05:02.000000Z", "2025-07-22T12:14:50.000000Z"], "y": [1.096774193548387, 1.0664136622390892, 1.0398481973434535, 1.0436432637571158, 1.0379506641366225]}, {"customdata": ["45.0.0", "46.0.0", "47.0.0", "48.0.1", "branch-49"], "hovertemplate": "<b>q20</b><br>Date: %{x}<br>Git SHA: %{customdata}<br>Normalized Ratio: %{y:.4f}s<br><extra></extra>", "line": {"width": 2}, "marker": {"size": 4}, "mode": "lines+markers", "name": "q20", "visible": true, "x": ["2025-02-03T21:26:35.000000Z", "2025-03-04T14:00:39.000000Z", "2025-04-16T19:35:01.000000Z", "2025-07-04T10:05:02.000000Z", "2025-07-22T12:14:50.000000Z"], "y": [1.1552587646076795, 1.0626043405676127, 1.0191986644407347, 1.018363939899833, 1.0258764607679467]}, {"customdata": ["46.0.0", "47.0.0", "48.0.1", "branch-49"], "hovertemplate": "<b>q28</b><br>Date: %{x}<br>Git SHA: %{customdata}<br>Normalized Ratio: %{y:.4f}s<br><extra></extra>", "line": {"width": 2}, "marker": {"size": 4}, "mode": "lines+markers", "name": "q28", "visible": true, "x": ["2025-03-04T14:00:39.000000Z", "2025-04-16T19:35:01.000000Z", "2025-07-04T10:05:02.000000Z", "2025-07-22T12:14:50.000000Z"], "y": [1.0893831652058872, 1.0700347279642797, 1.0454770960807012, 1.002976682652555]}], "layout": {"annotations": [{"CUSTOM_ANNOTATION": "release", "bgcolor": "rgba(255,255,255,0.7)", "bordercolor": "red", "font": {"color": "red", "size": 12}, "showarrow": false, "text": "49.0.0", "x": "2025-07-22T12:14:50.000000Z", "xanchor": "left", "y": 1.01, "yanchor": "bottom", "yref": "paper"}, {"CUSTOM_ANNOTATION": "release", "bgcolor": "rgba(255,255,255,0.7)", "bordercolor": "red", "font": {"color": "red", "size": 12}, "showarrow": false, "text": "48.0.1", "x": "2025-07-04T10:05:02.000000Z", "xanchor": "left", "y": 1.01, "yanchor": "bottom", "yref": "paper"}, {"CUSTOM_ANNOTATION": "release", "bgcolor": "rgba(255,255,255,0.7)", "bordercolor": "red", "font": {"color": "red", "size": 12}, "showarrow": false, "text": "47.0.0", "x": "2025-04-16T19:35:01.000000Z", "xanchor": "left", "y": 1.01, "yanchor": "bottom", "yref": "paper"}, {"CUSTOM_ANNOTATION": "release", "bgcolor": "rgba(255,255,255,0.7)", "bordercolor": "red", "font": {"color": "red", "size": 12}, "showarrow": false, "text": "46.0.0", "x": "2025-03-04T14:00:39.000000Z", "xanchor": "left", "y": 1.01, "yanchor": "bottom", "yref": "paper"}, {"CUSTOM_ANNOTATION": "release", "bgcolor": "rgba(255,255,255,0.7)", "bordercolor": "red", "font": {"color": "red", "size": 12}, "showarrow": false, "text": "45.0.0", "x": "2025-02-03T21:26:35.000000Z", "xanchor": "left", "y": 1.01, "yanchor": "bottom", "yref": "paper"}], "height": 600, "hovermode": "x unified", "margin": {"b": 50, "l": 50, "r": 50, "t": 80}, "shapes": [{"CUSTOM_ANNOTATION": "release", "line": {"color": "red", "dash": "dash", "width": 2}, "type": "line", "x0": "2025-07-22T12:14:50.000000Z", "x1": "2025-07-22T12:14:50.000000Z", "y0": 0, "y1": 1, "yref": "paper"}, {"CUSTOM_ANNOTATION": "release", "line": {"color": "red", "dash": "dash", "width": 2}, "type": "line", "x0": "2025-07-04T10:05:02.000000Z", "x1": "2025-07-04T10:05:02.000000Z", "y0": 0, "y1": 1, "yref": "paper"}, {"CUSTOM_ANNOTATION": "release", "line": {"color": "red", "dash": "dash", "width": 2}, "type": "line", "x0": "2025-04-16T19:35:01.000000Z", "x1": "2025-04-16T19:35:01.000000Z", "y0": 0, "y1": 1, "yref": "paper"}, {"CUSTOM_ANNOTATION": "release", "line": {"color": "red", "dash": "dash", "width": 2}, "type": "line", "x0": "2025-03-04T14:00:39.000000Z", "x1": "2025-03-04T14:00:39.000000Z", "y0": 0, "y1": 1, "yref": "paper"}, {"CUSTOM_ANNOTATION": "release", "line": {"color": "red", "dash": "dash", "width": 2}, "type": "line", "x0": "2025-02-03T21:26:35.000000Z", "x1": "2025-02-03T21:26:35.000000Z", "y0": 0, "y1": 1, "yref": "paper"}], "template": "plotly_white", "title": "Individual Query Performance Over Time", "xaxis": {"title": "Git Revision Timestamp"}, "yaxis": {"title": "Median Normalized Execution Time", "type": "linear"}}}};
        var releaseData = {"mostRecent": "2025-07-22T08:14:50-04:00", "mostRecentRelease": "41.0.0", "releases": ["branch-49", "48.0.0", "48.0.1", "47.0.0", "46.0.0", "45.0.0", "44.0.0", "43.0.0", "42.0.0", "41.0.0"]};
        
        function updateCharts() {
            const filter = document.getElementById('timeFilter').value;
            const showReleaseLines = document.getElementById('showReleaseLines').checked;
            const showEventLines = document.getElementById('showEventLines').checked;
            const description = document.getElementById('filterDescription');
            
            let filteredPerformanceData, filteredQueryData, descText;
            
            switch(filter) {
                case 'all':
                    filteredPerformanceData = chartData.performance;
                    filteredQueryData = chartData.queries;
                    descText = 'Showing all available data';
                    break;
                case 'releases_vs_main':
                    filteredPerformanceData = filterReleasesVsMain(chartData.performance);
                    filteredQueryData = filterReleasesVsMain(chartData.queries);
                    descText = 'Showing releases from releases.json and most recent main branch data';
                    break;
                case 'last_week':
                    filteredPerformanceData = filterLastPeriod(chartData.performance, 7);
                    filteredQueryData = filterLastPeriod(chartData.queries, 7);
                    descText = 'Showing data from the last 7 days';
                    break;
                case 'last_3_months':
                    filteredPerformanceData = filterLastPeriod(chartData.performance, 90);
                    filteredQueryData = filterLastPeriod(chartData.queries, 90);
                    descText = 'Showing data from the last 3 months';
                    break;
                case 'last_6_months':
                    filteredPerformanceData = filterLastPeriod(chartData.performance, 180);
                    filteredQueryData = filterLastPeriod(chartData.queries, 180);
                    descText = 'Showing data from the last 6 months';
                    break;
            }
            
            // If "Show releases" is unchecked, remove the vertical lines and annotations
            if(!showReleaseLines) {
                filteredPerformanceData = removeReleaseLines(filteredPerformanceData);
                filteredQueryData = removeReleaseLines(filteredQueryData);
            }
            
            // If "Show events" is unchecked, remove the event lines
            if(!showEventLines) {
                filteredPerformanceData = removeEventLines(filteredPerformanceData);
                filteredQueryData = removeEventLines(filteredQueryData);
            }
            
            description.textContent = descText;
            
            // Update performance chart
            Plotly.newPlot('performance_chart', filteredPerformanceData.data, filteredPerformanceData.layout, filteredPerformanceData.config);
            
            // Update per-query chart
            Plotly.newPlot('per_query_chart', filteredQueryData.data, filteredQueryData.layout, filteredQueryData.config);
        }
        
        function removeReleaseLines(chartObj) {
            // Create a copy with release lines removed
            const newLayout = {...chartObj.layout};
            newLayout.shapes = newLayout.shapes.filter(shape => 
                shape.CUSTOM_ANNOTATION && shape.CUSTOM_ANNOTATION !== "release"
            );
            newLayout.annotations = newLayout.annotations.filter(ann => 
                ann.CUSTOM_ANNOTATION && ann.CUSTOM_ANNOTATION !== "release"
            );
            
            return {
                data: chartObj.data,
                layout: newLayout,
                config: chartObj.config
            };
        }
        
        function removeEventLines(chartObj) {
            // Create a copy with event lines removed
            const newLayout = {...chartObj.layout};
            newLayout.shapes = newLayout.shapes.filter(shape => 
                shape.CUSTOM_ANNOTATION && shape.CUSTOM_ANNOTATION !== "event"
            );
            newLayout.annotations = newLayout.annotations.filter(ann => 
                ann.CUSTOM_ANNOTATION && ann.CUSTOM_ANNOTATION !== "event"
            );
            
            return {
                data: chartObj.data,
                layout: newLayout,
                config: chartObj.config
            };
        }
        
        function filterReleasesVsMain(chartObj) {
            // Filter to include only releases and the most recent revision
            const releases = releaseData.releases;
            const mostRecentTimestamp = releaseData.mostRecent;
            const mostRecentDate = mostRecentTimestamp ? new Date(mostRecentTimestamp) : null;
            
            const filteredData = chartObj.data.map(trace => {
                const filteredX = [];
                const filteredY = [];
                const filteredCustomdata = [];
                
                for(let i = 0; i < trace.x.length; i++) {
                    const timestamp = new Date(trace.x[i]);
                    const revision = trace.customdata ? trace.customdata[i] : '';
                    
                    // Include if it's a release or the most recent data
                    // Use date comparison for most recent timestamp to handle formatting differences
                    const isMostRecent = mostRecentDate && Math.abs(timestamp.getTime() - mostRecentDate.getTime()) < 1000; // Within 1 second
                    
                    if(releases.includes(revision) || isMostRecent) {
                        filteredX.push(trace.x[i]);
                        filteredY.push(trace.y[i]);
                        if(trace.customdata) filteredCustomdata.push(trace.customdata[i]);
                    }
                }
                
                const newTrace = {...trace};
                newTrace.x = filteredX;
                newTrace.y = filteredY;
                if(trace.customdata) newTrace.customdata = filteredCustomdata;
                return newTrace;
            });
            
            return {
                data: filteredData,
                layout: chartObj.layout,
                config: chartObj.config
            };
        }
        
        function filterLastPeriod(chartObj, days) {
            const cutoffDate = new Date();
            cutoffDate.setDate(cutoffDate.getDate() - days);
            
            // For short periods (week/month), only include the most recent release and recent data
            const mostRecentRelease = releaseData.mostRecentRelease;
            
            const filteredData = chartObj.data.map(trace => {
                const filteredX = [];
                const filteredY = [];
                const filteredCustomdata = [];
                
                for(let i = 0; i < trace.x.length; i++) {
                    const timestamp = new Date(trace.x[i]);
                    const revision = trace.customdata ? trace.customdata[i] : '';
                    
                    // For last week view, only include data from actual last 7 days
                    if(days === 7) {
                        if(timestamp >= cutoffDate) {
                            filteredX.push(trace.x[i]);
                            filteredY.push(trace.y[i]);
                            if(trace.customdata) filteredCustomdata.push(trace.customdata[i]);
                        }
                    } else {
                        // For other short periods, include recent data OR the most recent release
                        if(timestamp >= cutoffDate || revision === mostRecentRelease) {
                            filteredX.push(trace.x[i]);
                            filteredY.push(trace.y[i]);
                            if(trace.customdata) filteredCustomdata.push(trace.customdata[i]);
                        }
                    }
                }
                
                const newTrace = {...trace};
                newTrace.x = filteredX;
                newTrace.y = filteredY;
                if(trace.customdata) newTrace.customdata = filteredCustomdata;
                return newTrace;
            });
            
            // Update layout to filter vertical lines and annotations based on time period
            const newLayout = {...chartObj.layout};
            if(days === 7) { // For last week view, remove all vertical bars
                newLayout.shapes = [];
                newLayout.annotations = [];
            } else {
                // For all other periods, filter shapes and annotations based on cutoff date
                newLayout.shapes = chartObj.layout.shapes ? chartObj.layout.shapes.filter(shape => {
                    // Parse the timestamp from the shape's x0 coordinate
                    const shapeDate = new Date(shape.x0);
                    
                    // For month views, only show most recent release OR releases within time range
                    if(days <= 30) {
                        return chartObj.layout.annotations && chartObj.layout.annotations.some(ann => 
                            ann.x === shape.x0 && ann.text && ann.text.includes(mostRecentRelease)
                        );
                    } else {
                        // For 3 and 6 month views, only show releases within the time range
                        return shapeDate >= cutoffDate;
                    }
                }) : [];
                
                newLayout.annotations = chartObj.layout.annotations ? chartObj.layout.annotations.filter(ann => {
                    // Parse the timestamp from the annotation's x coordinate
                    const annDate = new Date(ann.x);
                    
                    // For month views, only show most recent release
                    if(days <= 30) {
                        return ann.text && ann.text.includes(mostRecentRelease);
                    } else {
                        // For 3 and 6 month views, only show releases within the time range
                        return annDate >= cutoffDate;
                    }
                }) : [];
            }
            
            return {
                data: filteredData,
                layout: newLayout,
                config: chartObj.config
            };
        }
        
        function filterOutReleases(chartObj) {
            // Filter out release revisions
            const releases = releaseData.releases;
            
            const filteredData = chartObj.data.map(trace => {
                const filteredX = [];
                const filteredY = [];
                const filteredCustomdata = [];
                
                for(let i = 0; i < trace.x.length; i++) {
                    const revision = trace.customdata ? trace.customdata[i] : '';
                    
                    // Exclude if it's a release revision
                    if(!releases.includes(revision)) {
                        filteredX.push(trace.x[i]);
                        filteredY.push(trace.y[i]);
                        if(trace.customdata) filteredCustomdata.push(trace.customdata[i]);
                    }
                }
                
                const newTrace = {...trace};
                newTrace.x = filteredX;
                newTrace.y = filteredY;
                if(trace.customdata) newTrace.customdata = filteredCustomdata;
                return newTrace;
            });
            
            return {
                data: filteredData,
                layout: chartObj.layout,
                config: chartObj.config
            };
        }
        
        // Initialize charts with default filter (releases vs main)
        document.addEventListener('DOMContentLoaded', function() {
            updateCharts();
        });
    </script>
</body>
</html>